---
title: "Exploration of fish operation data"
author: "Alain Danet"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Exploration}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.dim = c(7, 7)
)
library(tidyverse)
library(magrittr)
library(cowplot)
devtools::load_all()
theme_set(theme_alain())
```

```{r data_prep}
data(operation_data)
op <- select(operation_data, opcod:year, count)
rm(operation_data)
```

There was `r nb_op <- length(unique(op$opcod)); nb_op` fishing operations from
`r min(op$year)` to `r max(op$year)`. The sampling was distributed over `r nb_st <- length(unique(op$station)); nb_st` stations. It represents a average effort of `r round(nb_op/nb_st, 1)` (# visit/station).

# Distribution of sampling effort

```{r sampling effort} 
op_sampling <- op %>%
  group_by(opcod, station, year, month) %>%
  summarise(
    nb_ind = sum(count),
    nb_sp  = n()
    ) 

op_hist <- op_sampling %>%
  group_by(station) %>%
  summarise(freq = n()) %>%
  arrange(desc(freq)) %>%
  mutate(station = fct_inorder(as.factor(station)))

cdf_op <- ggplot(op_hist, aes(x=freq)) + stat_ecdf() +
  labs(x = "Number of sampling by station",
    y = "Frequency",
    title = "Cumulative distribution function") +
  scale_x_continuous(breaks = seq(0, 30, by = 5)) 
hist_op <- ggplot(op_hist, aes(x = freq)) +
  geom_bar() +
  labs(x = "Number of sampling by station",
    y = "Frequency",
    title = "Frequency distribution") +
  scale_x_continuous(breaks = seq(0, 30, by = 5))

plot_grid(cdf_op, hist_op, nrow = 2) 
``` 

Overall, the sampling effort by station is low and unevenly distributed. More
than 50% of the station had been visited one time and only 10% had been visited
more than 10 times. But we have no information about the spatial distribution of
the station. Some of them are surely really close from each other.

# Sampling effort by yearÂ 

```{r}
op_year <- op_sampling %>% group_by(year) %>%
  summarise(freq = n()) %>%
  arrange(desc(freq)) 

cdf_op <- ggplot(op_year, aes(x = freq)) + stat_ecdf() +
  labs(x = "Number of sampling by year",
    y = "Frequency",
    title = "Cumulative distribution function") +
  scale_x_continuous(breaks = seq(0, 1500, by = 100)) 
year_op <- ggplot(op_year, aes(y = freq, x = year)) +
  geom_line() +
  geom_point() +
  labs(y = "Number of sampling events",
    x = "Year",
    title = "")
plot_grid(cdf_op, year_op, nrow = 2) 
```

We see that the sampling effort increase around 1992 from nearly 250 to 1000
sampled stations by year.

# Sampling area

I need the geographical datas
