# Results


## Network description 

```{r net-cor-med, fig.cap = "Correlation between network indices (median over the temporal series). "}
# Get network metrics
myload(temporal_network_metrics, dir = mypath("data", "classes"))
temporal_network_metrics_classes <- temporal_network_metrics
myload(temporal_network_metrics, dir = dest_dir)
myload(temporal_community_metrics, synchrony, dir = data_common)

cor_avg <- temporal_network_metrics %>%
  select_at(vars(dplyr::matches("med"))) %>%
  na.omit %>%
  cor(., method = "spearman")
#knitr::kable(cor_avg)
as.data.frame(round(cor_avg,2)) %>%
  mutate_all(funs(cell_spec(., "html", color = ifelse(abs(.) > .65 & . != 1, "red",
	  "black")))) %>%
  mutate(variable = colnames(.)) %>%
  select(variable, everything()) %>%
  kable(format = "html", escape = F)
```

```{r net-cor-cv, fig.cap="Correlation between network indices (CV over the temporal series). "}
cor_cv <- temporal_network_metrics %>%
  select_at(vars(dplyr::matches("cv"))) %>%
  na.omit %>%
  cor(., method = "spearman")

as.data.frame(round(cor_cv,2)) %>%
  mutate_all(funs(cell_spec(., "html", color = ifelse(abs(.) > .65 & . != 1, "red",
	  "black")))) %>%
  mutate(variable = colnames(.)) %>%
  select(variable, everything()) %>%
  kable(format = "html", escape = F)
```

```{r}
library(ade4)
library(factoextra)

net_ind <- temporal_network_metrics %>%
  left_join(select(temporal_community_metrics, station, richness_med)) %>%
  select_at(vars(dplyr::matches("med")))

res.pca <- dudi.pca(na.omit(net_ind),
  scannf = FALSE,   # Hide scree plot
  nf = 5            # Number of components kept in the results
)
eig_plot <- fviz_eig(res.pca)
```

```{r}
pca_plot <- lapply(list(c(1,2), c(1, 3), c(3, 2)), function (axes) {
  fviz_pca_var(res.pca,
    axes = axes,
    col.var = "contrib", # Color by contributions to the PC
    gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
    repel = TRUE     # Avoid text overlapping
  )
})

plot_grid(eig_plot, pca_plot[[1]], pca_plot[[2]], pca_plot[[3]], labels =
  "AUTO")
```


### Look at some network temporal series


Let's look at network that have particular network properties. 

```{r}
myload(network_analysis, dir = mypath("data", "species"))
myload(op_analysis, metaweb_analysis, dir = data_common)
meta <- metaweb_analysis; rm(metaweb_analysis)

net <- network_analysis %>%
  dplyr::select(opcod, network) %>%
  unnest() %>%
  left_join(., dplyr::select(op_analysis, opcod, station, date)) 
```

```{r}
station_high_low_modularity <- temporal_network_metrics %>%
  arrange(desc(modularity_med)) %>%
  slice(c(1, n())) %>%
  select(station) %>%
  unlist
names(station_high_low_modularity) <- c("high", "low") 
```

```{r tmp-net-h-mod, fig.cap = "Station with the highest modularity (median)."}
# High modularity
net_ex <- filter(net, station == station_high_low_modularity["high"])

my_crap_temporal_network(net = net_ex, metaweb = meta$metaweb, network_data
  = network_analysis)
```
```{r tmp-net-l-mod, fig.cap = "Station with the lowest modularity (median)."}
# Low modularity
net_ex <- filter(net, station == station_high_low_modularity["low"])
my_crap_temporal_network(net = net_ex, metaweb = meta$metaweb, network_data
  = network_analysis)
```

```{r}
station_high_low_nestedness <- temporal_network_metrics %>%
  arrange(desc(nestedness_med)) %>%
  slice(c(1, n())) %>%
  select(station) %>%
  unlist
names(station_high_low_nestedness) <- c("high", "low") 
```
```{r tmp-net-h-nest, fig.cap = "Station with the highest nestedness (median)."}
# high nestedness
net_ex <- filter(net, station == station_high_low_nestedness["high"])
my_crap_temporal_network(net = net_ex, metaweb = meta$metaweb, network_data
  = network_analysis)
```

```{r tmp-net-l-nest, fig.cap = "Station with the lowest nestedness (median)."}
# low nestedness
net_ex <- filter(net, station == station_high_low_nestedness["low"])
my_crap_temporal_network(net = net_ex, metaweb = meta$metaweb, network_data
  = network_analysis)
```


