---
title: Species richness and network structure jointly drive total biomass and its temporal stability in fish communities
author: Alain Danet, Maud Mouchet, Willem Bonnaffe, Elisa Thebault, Colin Fontaine
date: \today 
output:
  bookdown::pdf_document2:
    toc: false 
    fig_caption: true 
    keep_tex: true
fontsize: 12pt
header-includes:
   - \usepackage{setspace}
   - \doublespacing
   - \usepackage{lineno}
   - \linenumbers
geometry: margin=2cm
bibliography: references.bib
---

```{r, echo = FALSE, results = FALSE, message = FALSE}
mypath <- rprojroot::find_package_root_file
data_common <- mypath("data")
dest_dir <- mypath("data", "species")

knitr::opts_chunk$set(
  cache = TRUE,
  collapse = TRUE,
  comment = "#>",
  #fig.dim = c(7, 7),
  fig.fullwidth = TRUE,
  fig.show = "hold",
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  results = FALSE 
)

library(tidyverse)
library(magrittr)
library(ggeffects)
library(cowplot)
library(kableExtra)
source(mypath("R", "misc.R"))
source(mypath("R", "plot_methods.R"))
source(mypath("R", "community_analysis.R"))
source(mypath("R", "community_methods.R"))
source(mypath("R", "statistical_analysis.R"))
source(mypath("R", "total_sem_effect.R"))
source(mypath("R", "press_methods.R"))
source(mypath("R", "geo_methods.R"))
source(mypath("R", "synchrony.R"))

theme_set(theme_alain())
```

```{r, results = FALSE}
knitr::opts_chunk$set(
  results = TRUE 
)
```

- Author affiliation:
  - Alain Danet:
  - Maud Mouchet:
  - Willem Bonnaffe:
  - Elisa Thebault: 
  - Colin Fontaine:

- Author contributions: AD, CF, MM and ET designed the study. WB designed the
  network inference method and collected the food diet data. AD performed the
  data analysis and wrote the first draft of the manuscript. All authors
  contributed substantially to revisions.

- Data accessibility statement: the ONEMA database is available upon request to 
  eddy.cosson@afbiodiversite.fr and thierry.point@afbiodiversite.fr. The code
  used for the analysis and to generate the manuscript is available on github:
  (alaindanet/fishcom.git)

- Article type: Letters

- Number of words:
  - Abstract: 184
  - Main text: 4929 

- Number of references: XXX
- Number of figures: 2
- Number of tables: 1
- Number of text boxes: 0 

- Coresponding author:
  - Alain Danet
  - UMR 7204 CESCO, BP 61; 45, rue Buffon, 75005 Paris, France
  - alain.danet@mnhn.fr 
  - +33140798134

# Abstract

Both the relations between diversity and ecosystem functioning, and between food
web complexity and stability, have received considerable attention during the
last decades in ecology. While the former relation remains rarely investigated
in the context of food webs, especially in empirical studies explicitly
considering food web structures, the latter has been mainly the focus of
theoretical studies and empirical tests are critically missing. Here we link
species richness, food web structure and total biomass and its stability by
using a dataset of standardized fish sampling in French streams running from
1995 to 2018. We inferred trophic interactions thanks to recorded body size and
diet literature. We reveal that species richness and average trophic level had a
positive relationship with total biomass of fish communities while they had
respectively a negative and positive effect on its temporal stability. We
also found that the effects of stream size and temperature on total biomass and
stability are partly mediated by their effects on diversity and food web
structure. Overall, our study opens fruitful perspectives on the link between
species richness, network structure, ecosystem properties and their stability.

# Introduction 

---
#### Biodiversity and ecosystem properties 
---

Current biodiversity losses and global changes has the potential to affect
ecosystems in complex ways [@bellard_impacts_2012]. Biodiversity has a
tremendous effect on ecosystem properties because it largely determines both the
amount and the distribution of matter and energy fluxes
within and among ecosystems [@duffy_why_2009]. Biodiversity thus affects biomass
production [@tilman_productivity_1996;Â @cardinale_species_2002;
@grace_integrative_2016], biomass repartition [@thebault_relationship_2006] and
biomass stability [@thebault_trophic_2005; @thebault_relationship_2006;
@tilman_biodiversity_2006]. The relationship between biodiversity and
ecosystem properties is a central topic in ecology [@hector_plant_1999;
@loreau_biodiversity_2001; @hooper_effects_2005; @dunne_network_2006;
@duffy_why_2009; @isbell_forest_quantifying_2018] and its documentation is thus
crucial to better anticipate the impacts of global changes. 

---
#### Species richness increases total biomass
---

Species richness promotes higher biomass production in a variety of ecosystems
and taxons. Indeed species richness generally increases primary productivity and
total biomass in experimental plant communities [@tilman_productivity_1996;
@grace_integrative_2016; @hector_plant_1999; @tilman_biodiversity_2014;
@grace_integrative_2016], but also in briophyte communities
[@mulder_physical_2001], stream feeders [@cardinale_species_2002] and aquatic
bacterial consumers [@pennekamp_biodiversity_2018]. Despite the diversity of
ecosystems and taxons studied, the relation between diversity and ecosystem
functioning remains traditionally focused on single trophic levels, ignoring the
effects of food web structure. Theoretical models have recently extended
classical theoretical studies in plant communities [@tilman_plant_1997;
@loreau_biodiversity_2001] to food webs [@thebault_food-web_2003;
@poisot_dissimilarity_2012; @schneider_animal_2016; @wang_biodiversity_2018].
These models show that both resource use complementarity and selection effects,
the two main mechanisms previously highlighted in single-trophic studies, are
also important to understand diversity effects in food webs
[@thebault_food-web_2003; @poisot_dissimilarity_2012; @schneider_animal_2016].
However, they also reveal new mechanisms such as positive effects of diversity
of trophic levels, i.e. associated with higher trophic levels, on ecosystem
functioning [@wang_biodiversity_2018]. Theoretical studies also showed that food
web properties, such as interaction distribution and strength, affect the
distribution of biomass among adjacent trophic levels
[@thebault_relationship_2006; @schneider_animal_2016; @barbier_pyramids_2019].
Empirical studies are however missing to assess further how food web structure,
in conjunction with species diversity, affect total biomass production and other
ecosystem properties.   

---
#### Single and multitrophic communities
---

Many studies showed that species richness also increases temporal stability of
communities, i.e. variation through time, often quantified by the temporal CV.
Such positive relationships between species richness and temporal stability have
been reported in experimental grasslands and aquatic bacterial systems
[@tilman_biodiversity_2006; @pennekamp_biodiversity_2018] as well as in natural
settings, such as stream fish communities [@franssen_annual_2011], bird and
butterfly communities [@olivier_urbanization_2020]. However, this relation has
been mostly explored in single trophic level systems or without accounting for
food web structure, even more so than the relation between diversity and biomass
production. Single-level theoretical works have clarified which mechanisms
generate this positive relationship between species richness and temporal
stability [@loreau_species_2008; @thibaut_understanding_2013], (1) species
synchrony and (2) species variability. Species synchrony quantify to what extent
the fluctuations of abundances or biomasses through time are correlated among
species. A low synchrony in species fluctuations, i.e.  asynchrony, is
synonymous of compensatory dynamic, where the decrease in abundance of a species
is compensated by the increase of an other.  Asynchrony is generally the main
mechanism whereby species richness has a stabilizing effect on temporal
stability [@tilman_biodiversity_2006; @olivier_urbanization_2020] while
positive, neutral and negative relationships have been found in natural settings
[@tilman_biodiversity_2006; @thibaut_understanding_2013;
@olivier_urbanization_2020]. In addition to diversity, food web structure is
expected to strongly affect the stability of communities and ecosystems, as
outlined by the large body of theoretical studies on this topic [@may_will_1972;
@dunne_network_2006; @neutel_reconciling_2007; @duffy_why_2009;
@stouffer_compartmentalization_2011]. For instance, predation has cascading
effects on species variability [@shanafelt_stability_2018] and it affects as
well synchrony between species [@teng_dynamics_2004]. Despite a long-standing
interest on the links between food web complexity and stability in ecology, to
date we have very few evidence on the relationship between network structure and
the temporal stability of species and total biomass in empirical multitrophic
communities. 

---
#### Problematic
---

Overall, the evidence suggests that both species richness and network structure
should modulate total biomass and stability of communities. The effects of
species richness and network structure, such as connectance and average trophic
level, are potentially conflicting or synergistic in such a way that they need
to be addressed jointly. Yet, there is no direct empirical evidence to date for
the combined effects of species richness and network structure on total biomass
and stability in natural communities.

Although the relationships between diversity, total biomass and its stability in
natural systems can be similar to those found in experimental communities [e.g.,
@wu_relationship_2015; @li_relationship_2018], negative or non significant
effects of species richness on total biomass have for example been found in some
natural communities such as forests [@szwagrzyk_above-ground_2007;
@jacob_productivity_2010; @seidel_relationship_2013]. Some authors suggest that
the lack of resource complementarity or environmental harshness might be
responsible for an absence or a negative effect of species richness
[@loreau_biodiversity_2001; @he_global_2013; @wu_relationship_2015]. These
different relations might also arise from effects of the environment on both
diversity and ecosystem functions [@loreau_biodiversity_2001].

---
#### Environment can mitigate community structure and ecosystem properties 
---

When assessing the relationship between community structure and ecosystem
properties in natural communities, it is indeed crucial to consider
environmental factors [@loreau_biodiversity_2001; @he_global_2013;
@grace_integrative_2016]. Environment affects organism performance directly, and
thereby, species abundances, total biomass [@grace_integrative_2016] and temporal
stability [@de_boeck_patterns_2017; @hansen_climate_2013; @bluthgen_land_2016;
@oliver_heterogeneous_2010; @franssen_annual_2011; @friedpetersen_drivers_2020].
For example, greater ecosystem size might increase the number of available
resources and thus total biomass [@post_ecosystem_2000; @doi_resource_2009].
@li_relationship_2018 have notably shown that climate moisture has a positive
direct effect on total biomass, but also indirect through a positive effect on
species richness. Accounting for environment also allow for an overall
comparison of the strength of the effects of environment and community structure
on total biomass and its stability.

---
#### Stream fish communities is a good model to study effects of horizontal & vertical diversity
---

Because their trophic interactions can be inferred, stream fish community
constitutes a good model to study the effects of network structure on total
biomass and its temporal stability. Despite that fish trophic
interactions are difficult to measure in natural conditions, a consequent body
of literature supports that they can be inferred through body size and diet
informations [@gravel_inferring_2013; @jennings_weak_2001;
@brose_predator_2019]. Especially in stream communities, including fishes,
@brose_predator_2019 found that the prediction of predator prey trophic
interactions based on body size ratio was far better in stream ecosystems than
in other aquatic and terrestrial ecosystems. Furthermore, the biotic activity in
stream ecosystems determines for a large part the water quality
[@cummins_structure_1974] and thus are crucial to maintain stream ecosystem
properties. Lastly, most of the diversity-biomass and diversity-stability
relationships, have been assessed in terrestrial ecosystems while there is a
evident need to test such relationships in a variety of ecosystem types.

Our study aims to document the relationships between food web structure and
total biomass and its temporal stability in natural communities. To do so, we
used the ONEMA dataset consisting in standardized sampling of fish communities
in French streams [@edeline_ecological_2013]. 99 sites were sampled for more than 10
years spanning on the 1995-2018 period. We inferred 1496 interaction networks,
based on body size and food diet. We question whether species richness,
connectance and average trophic level increase, decrease or are not related to
total biomass and its temporal stability. We further question whether the
species richness, connectance and average trophic level have antagonistic or
synergistic effect on total biomass and its temporal stability. Finally, we
question if ecosystem size and average temperature increase total biomass and
its temporal stability.


# Methods

```{r}
matmet_cap <- paste0(
  #"(A) Conceptual model of the hypothesized relationships between environment,
  #species richness, network metrics and total biomass / biomass stability. ",
  #"Solid and dashed arrows represent respectively direct and indirect effects.
  #",
  #"The blue, green and blue/green dashed arrows being respectively indirect
  #effects going through species richness, network metrics and through both
  #species richness and network metrics.",
  "(A) Observation sites (black dots) were located across France and monitored
  on the period 1995-2018. ", "Grey shades highlighted elevalation variation. ",
  "Inner borders draw the limits of the hydrographic basins. ",
  "(B) The metaweb. Each trophic species (N = 412) is represented by a node and
  each color represent a species (S = 45). Resource nodes (7) were drawn in grey. ",
  "(C) Subset over network variation through time. The species names
  corresponding to the three digit codes are found in Table SXX."
)
```

```{r matmet, fig.cap = matmet_cap}
myload(p_st,temporal_network, dir = mypath("manuscript/bef_stability/figs"))

# Network inference
net_method_path <- mypath("manuscript/bef_stability/figs",
  "hypothesis.pdf")
metaweb_path <- mypath("manuscript/bef_stability/figs",
  "metaweb.png")
library(magick)

p_net_method <- cowplot::ggdraw() +
  cowplot::draw_image(magick::image_read_pdf(net_method_path))
p_metaweb <- cowplot::ggdraw() +
  cowplot::draw_image(magick::image_read(metaweb_path))

top <- plot_grid(p_net_method, p_st, ncol = 2, rel_widths = c(1, 1), labels =
  "AUTO")
bottom <- plot_grid(p_metaweb, temporal_network, ncol = 2,
  rel_widths = c(1, 1), labels = c("C", "D"))

left <- plot_grid(p_st, p_metaweb, ncol = 1, rel_widths = c(1, 1), labels =
  c("A", "B"))
p_test <- plot_grid(left, temporal_network, ncol = 2, labels = c("A", "C"))

p_method <- plot_grid(top, bottom, nrow = 2, rel_heights = c(1, 1),
  labels = c("", "C"))
save_plot(
  filename = mypath("manuscript/bef_stability/figs",
    "method_fig.pdf"),
  p_test, nrow = 2, ncol =2,
  base_width = 7/2.54,
  base_asp = 0.3
)
p_test
```


## Data preparation and filtering

Fish communities were monitored across stream sections in France on the period
1995-2018 by the French Office of Water and Aquatic Ecosystems (ONEMA) using
electric fishing. Two different standardized protocols were used for small and
large streams (detailed in Supplementary material, part 1.1). For streams
shallower than 0.7m across the entire width, the sampling took place over the
whole width of the streams and was done by foot whereas in streams deeper than
0.7m, the sampling was done over the bank by foot or by boat. The sampling
season spanned from late spring to autumn. During sampling, all the fishes
caught were identified and recorded. For each species, either the body size of
all fish was measured, or a representative sample when the number of fish was
high (Figure S1, supplementary information). The fishes were released at the end
of the sampling. Additionally, the physical characteristics of the river was
recorded during sampling as well as the sampling effort, quantified as the
surface sampled (range XXX-XXX).

The stations where the stream was of intermediate size could be sampled
alternatively with one of the two sampling protocols. When it was the case, we
kept only the most frequently used sampling protocol. Finally, we kept stations
that had been sampled ten years or more. there was low heterogeneity of the sampling month
within stations, with the median sampled month being 
mid-August while the median of the standard deviation of the sampled month
within station was $0.7$. As the concept of community variability referred to variability
around an equilibrium, which is rarely observed or difficult to characterize in
natural communities, only those stations with no temporal trends in total
biomass were selected (detailed in supplementary methods). However, the results
were robust to the relaxation of this hypothesis (Supplementary results). These
selections resulted in 99 stations distributed over seven hydrographic basins
(Figure \@ref(fig:matmet) A).

## Variable computation

### Biomass estimation

The body size of all fish individuals was not recorded when they were too
numerous. The body size of the unmeasured individuals was inferred under the
assumption that species body size followed a normal distribution whose mean and
standard deviation were quantified from the recorded individuals of the sampling
(See supplementary methods, Figure S1). The body mass of each individual was
then estimated using an allometric law ($B_i = 0.01 \times l_i^{3.03}$, $B$
being the body mass in grams, $l$ the body size in millimeters and $i$ the
individual), where the coefficients $0.01$ and $3.03$ comes from two
meta-analyses on fishes [@lleonart_removing_2000; @froese_cube_2006]. Species
biomass and total biomass at each sampling event was then calculated by summing
individual body masses. To account for the variation in sampling effort among
sites, species biomass and total biomass have been related to the surface
sampled, i.e.  $gm^{-2}$. In the further analysis, the total biomass of a
station has been defined as the median of the total biomass over time.

### Stability measures

Temporal biomass stability was defined as the inverse of biomass variability.
Variability was computed as Coefficient of Variation (CV) of the biomass over
time ($CV_i = \sigma_i \mu_i^{-1}$, with $\sigma_i$ and $\mu_i$ being
respectively the standard deviation and the temporal average of the annual total
biomass of the station $i$). Then, temporal stability was equal to $CV^{-1} =
\mu \sigma^{-1}$.

In order to describe the mechanisms driving the temporal stability of biomass, we
decomposed the $CV$ of total biomass ($CV_{com}$) in synchrony ($\phi$) and
weighted average species $CV$ ($\overline{CV_{sp}}$) components according to
@thibaut_understanding_2013:

$$
CV_{com, i} = \overline{CV_{sp, i}} \times \sqrt{\phi_i}
$$

with $CV_{com, i}$ being the Coefficient of Variation of the biomass in the
station $i$, $\overline{CV_{sp, i}}$ the average coefficient of variation of
species in the station $i$ weighted by the biomass of the species, $B_{k,i}$.
Synchrony of the station $i$, $\phi_i$, is the ratio between the variance of
total biomass over time ($\sigma^2_{x_{T,i}}$) and the sum of the variance of
population biomass over time ($\sigma_{x_k}$), $i$ being the station $i$ and $k$
the species $k$ [@loreau_species_2008].

$$
\overline{CV_{sp, i}} = \sum_k{\frac{B_{k,i} {CV}_{k, i}}{\sum_k{B_{k,i}}}}
$$

$$
\phi_i = \frac{\sigma^2_{x_{T,i}}}{(\sum_k{\sqrt{\sigma^2_{x_{k,i}}}})^2}
$$

### Species richness

Species richness was computed as the total number of species present over time
in a given station. As for biomass, we controlled species richness for sampling
effort by dividing the total number of species by the total surface sampled in
the given station. Species richness was then expressed in number of species by
square meter sampled.

### Network building

```{r}
myload(metaweb_analysis, dir= mypath("data"))
myload(trophic_class, dir= mypath("data", "classes"))
meta <- metaweb_analysis
#metaweb_analysis$resource
#meta$metaweb[meta$resource, meta$resource]
```

We determined the network structure in two steps: (1) build a metaweb describing the
trophic interactions between all trophic species and the resources (Figure
\@ref(fig:matmet) C), then (2) determine network of a given community by
subtracting the metaweb according to the trophic species present in a given
site and sampling event (Figure \@ref(fig:matmet) D).

Trophic interaction network was inferred from body size and ontogenic diet shift
following previous studies [@gravel_inferring_2013; @brose_predator_2019;
@poisot_structure_2016]. The diet of stream fishes, as many organisms, shifts
over lifespan and thereby over body size. For example, alvins feed on plankton
while adults may feed on algae, fishes, with bigger individuals eating bigger
fishes. Each fish species was hence divided in nine body size classes, each
corresponding to a trophic species (Figure S2). Additionally to the fish trophic
species, we added seven resource nodes present in the ontogenic food diet database:
detritus, biofilm, phytoplankton, zooplankton, macrophages, phytobenthos and
zoobenthos (grey nodes in Figure \@ref(fig:matmet) C & D). The fish trophic
species and the resources constituted the 412 nodes of the metaweb, 45 fish
species divided into nine body classes plus seven resource nodes. The inference
of trophic interactions was shown to be more accurate when considering body size
classes, i.e. trophic species, rather than species [@jennings_weak_2001].

The feeding interactions of a fish node, i.e a trophic species, are determined
by both its species identity and its body size. Then, species identity allows to
differentiate between piscivorous and non piscivorous species, to know on which
resources the trophic species are feeding on and to know the minimum size at
which a piscivorous species begins to feed on fishes. The ontogenic fish diet
database was filled according to fishbase and literature (cf Bonnaffe ref). Each
fish species had two or three life stages which are delimited by a body size
range (Figure S2). The life stage of a fish trophic species was determined with
the center of its body size range, hereafter midpoint (Figure S2).

For a piscivorous trophic species, i.e. a piscivorous node, the fish-fish
trophic links was defined in two steps and based on the body size ratio between
predators and prey. First of all, the predation window of a piscivorous node was
defined as 3% to 45% of its midpoint [@mittelbach_ontogeny_1998;
@claessen_impact_2002; @hart_handbook_2008]. Then, a trophic link was set
between the piscivorous node and every node whose midpoint
was included in the predation range (Figure S2). The fish-resource trophic
links were set between the trophic species and the resources nodes according the
food diet of their size class, for both the piscivorous and non piscivorous
trophic species. Lastly, the trophic links between resource nodes were set
according to the food diet data [@allan_stream_2007; @hart_handbook_2008].

### Network structure

For each trophic network, corresponding to a particular site and year, we
computed two of the most commonly used network metrics to characterize food
webs, namely the connectance and mean trophic level. 
As the networks, the networks metrics were also based on the trophic species,
i.e. body size classes. Connectance describes the level of generalism in the
network and is calculated as the number of actual
interaction divided by the maximum number of interaction if all species interact
together ($C = L / N^2$, L and N being resp. the number of links and of trophic
species plus resource nodes). The mean trophic level $\overline{T}$ was computed
as the mean trophic level weighted by the biomass of each trophic species
(excluding resource nodes for which we had no biomass information), so
$\overline{T} = \sum_i^N{B_iT_i \times \sum_i^N{B_i}^{-1}}$, with $T_i$ and
$B_i$ being respectively the trophic level and the biomass of the node $i$. The
trophic level of the nodes was computed as one added to the average trophic
level of its food item. For each site, the median of connectance and average
trophic level over time was used in subsequent analysis.


```{r}
# Basin
st_basin <- get_basin_station(sf_obj = FALSE)

# Select fishing operation 
myload(op_analysis, op_analysis_wo_holes, dir = mypath("data"))
myload(biomass_ts_sax, dir = mypath("data"))
op_analysis_bbb <- filter(op_analysis, station %in%
  biomass_ts_sax[biomass_ts_sax$sax == "bbb",]$station)
op_analysis_wo_holes_bbb <- filter(op_analysis_wo_holes, station %in%
  biomass_ts_sax[biomass_ts_sax$sax == "bbb",]$station)

```

```{r, fig.show = "hide"}
myload(
  hab_analysis,
  temporal_station_desc,
  temporal_press_polluants,
  geo_station,
  dir = mypath("data")
)
habitat_press <- build_habitat_pressure_dataset(
  .habitat_analysis = hab_analysis,
  .tmp_press = temporal_press_polluants,
  .tmp_st_desc = temporal_station_desc,
  .geo_st = geo_station 
)

# Make PCA 
habitat_press %<>% na.omit()
mask <- names(habitat_press) %in% names(get_pca_var_name_replacement())

pca_rotated <- compute_rotated_pca(
  .data = habitat_press[, mask],
  naxis = 2
)
habitat_pressure <- 
  cbind(habitat_press[, c("station", "temperature_med", "alt")], pca_rotated$rotated$score) %>%
  as_tibble
ggplot(habitat_pressure, aes(x = RC2, y = temperature_med)) +
  geom_point()

ggplot(
  pivot_longer(habitat_pressure, cols = c("RC1", "RC2"),
    names_to = "variable", values_to = "value"
  )
  , aes(x = value)) +
geom_histogram() +
facet_grid(cols = vars(variable))

mysave(habitat_press, habitat_pressure, dir = mypath("data"))

```

```{r}
prop_var_expl_pca <- pca_rotated$rotated$Vaccounted["Proportion Var", ] %>%
  map_dbl(., ~round(.x * 100))
tot_var_expl_pca <- sum(prop_var_expl_pca) 
```

```{r, message = FALSE, results = FALSE}
# Com
com_data <- compute_community_temporal_analysis(.op = op_analysis_bbb,
 type_network_metrics = "classes"
)
# Compute sem dataset
sem_data <- compute_sem_dataset(
  com = com_data[["tps_com"]],
  network = com_data[["tps_net"]],
  hab_press = habitat_pressure,
  sync = com_data[["sync_std"]],
  nmds = NULL,
  basin = st_basin
  )

```


## Environmental variables

We characterised the sites by their altitude, slope, distance from
source, stream width and depth and its strahler order, i.e. its position in the
stream network. From the naiades database
[(www.naiades.eaufrance.fr)](http://www.naiades.eaufrance.fr/), we also
got data on water temperature and flow. As data from the naiades database are
not collected on the same site as our fish sampling sites, we performed an
interpolation with spatial stream networks [@isaak_applications_2014;
@hoef_ssn:_2014]. The interpolation procedure is detailed in supplementary (part
1.2).

We had one environmental variable value for each site and year event, except
for water temperature for which the record began in 2006. Then, we computed the
average and CV values of for water temperature, flow, BOD, river width and
depth. As habitat and environmental variables are often collinear, a principal
component analysis (PCA) was performed on the 14 scaled variables. We kept in
the analysis the two first principal components based on the elbow method, on
the eigen values distribution (Figure S4). The two first principal components
explained `r tot_var_expl_pca`% of the variance (Figure S4). A varimax axis rotation was
performed to maximize the representation of the variables by the principal
components [@kaiser_varimax_1958; @revelle_psych_2019]. The first axis
represented a gradient from small to big streams, characterized by their width
and depth, but also a gradient from stream close to far from the source. The
second axis represented a gradient of increasing average water temperature and
decreasing altitude and slope. Further description of the variables are provided
in supplementary information (part 1.3).

## Statistical analysis 

Structural Equation Modeling are able to assess multivariate relationships
between variables. It is one promising way to go beyond bivariate relationships
and to investigate complex relationships, direct and
indirect, between variables [@grace_structural_2008; @grace_causal_2014;
@lefcheck_piecewisesem_2016; @grace_integrative_2016]. The structural equation
model explaining the annual total biomass set that environment
can directly affect species richness and network structure, as well as annual total
biomass (Figure \@ref(fig:sem-plot) B). We assumed that both species richness
and network structure directly affect total biomass (Figure \@ref(fig:sem-plot)
B) and that species richness constrained food web structure
[@winemiller_must_1989; @dunne_network_2006; @thebault_stability_2010].  

We used the same model structure for temporal stability of biomass (Figure
\@ref(fig:sem-plot) A). Instead of the annual total biomass, we set the
synchrony and population variability which in turn determined the temporal
stability of biomass. The structural equation models used for annual total
biomass and its temporal stability contains respectively 4 and 6 response
variables, 35 and 26 direct paths.

The structural equation models were based on Gaussian linear models, some variables
were logged to fulfill model assumptions (see residual plots and data
transformation in supplementary informations, Table SXX). We set the seven
hydrographic basins as a random effect on the intercept of the linear models to
account for their heterogeneity. We checked for the absence of multicollinearity 
with Variance Inflation Factor (VIF, Table SXX). The slopes reported
in the main text were standardized in order to compare their magnitude ($r_\delta
= \beta \frac{\sigma_x}{\sigma_y}$, $\beta$ being the unstandardized slope,
$\sigma_x$ and $\sigma_y$ being respectively the standard deviation of the
predictive variable $x$ and of the response variable $y$). The paths whose
slope had a $P$ value inferior to $0.05$ were reported in the main text, all the
path values are presented in Table SXX and SXX).

The indirect effects of variables on total biomass and its temporal stability
was computed by multiplying slopes along the path. As an example, if we consider
$A \to B \to C$, the indirect effect of A on C is equal to $r_{AB} \times
r_{BC}$.  Only significant direct slopes were entered in the calculation of
indirect effects. Finally total effects were computed as the sum
of direct and indirect effects.

Environmental variables were interpolated with the `openStars` and `SSN`
R packages [@kattwinkel_openstars_2018; @hoef_ssn:_2014]. Linear models and SEMs
were computed with respectively the `nlme` and `piecewieseSEM` R packages
[@pinheiro_nlme_2020; @lefcheck_piecewisesem_2016]. The code used for the
analysis and the manuscript are accessible on github. The analysis were
performed with R version 3.6.3 [@r_core_team_r_2020].

```{r get-data}
library(piecewiseSEM)
library(lme4)
library(nlme)

#ctrl <- lmeControl(opt='optim')
ctrl_lmer <- lmerControl(optCtrl = list(method = 'optimx'))
```

```{r}
# Compute SEMs
stab_sem_rich <- compute_stab_sem_rich(.data = sem_data,
  random_effect = as.formula("~1|basin"))

bm_sem_rich <- compute_prod_sem_rich(.data = sem_data,
  random_effect = as.formula("~1|basin"))

def_env_x_pos <- c(from = 0, to = 3)
asp <- 1.6

library(DiagrammeR)
meta_stab_sem_rich <- export_diagram(
  fit = stab_sem_rich,
  file_path = mypath("manuscript", "bef_stability", "meta_stab_sem"),
  format = "png",
  width = 700*2,
  height = 700*2 * asp,
  arrows = "ortho",
  val_thd = 0.05,
  env_x_pos_range = def_env_x_pos,
  env_y_pos = 0,
  env_y_sep = 1.5,
  order_env_node = c("log_RC1", "log_RC2"),
  metamodel = TRUE
)
p_stab_sem_rich <- export_diagram(
  fit = stab_sem_rich,
  file_path = mypath("manuscript", "bef_stability", "stab_sem"),
  format = "png",
  width = 700*2,
  height = 700*2 * asp,
  arrows = "ortho",
  val_thd = 0.05,
  env_x_pos_range = def_env_x_pos,
  env_y_pos = 0,
  env_y_sep = 1.5,
  order_env_node = c("log_RC1", "log_RC2")
)

meta_bm_sem_rich <- export_diagram(
  fit = bm_sem_rich,
  file_path = mypath("manuscript", "bef_stability", "meta_bm_sem"),
  format = "png",
  width = 700*2,
  height = 700*2 * asp,
  arrows = "ortho",
  val_thd = 0.05,
  env_x_pos_range = def_env_x_pos,
  env_y_pos = 0,
  env_y_sep = 1.5,
  order_env_node = c("log_RC1", "log_RC2"),
  metamodel = TRUE
)
p_bm_sem_rich <- export_diagram(
  fit = bm_sem_rich,
  file_path = mypath("manuscript", "bef_stability", "bm_sem"),
  format = "png",
  width = 700*2,
  height = 700*2 * asp,
  arrows = "ortho",
  val_thd = 0.05,
  env_x_pos_range = def_env_x_pos,
  env_y_pos = 0,
  env_y_sep = 1.5,
  order_env_node = c("log_RC1", "log_RC2")
)
```


```{r get-sem-coeff}
coef_stab_sem <- coef(stab_sem_rich) %>%
  select(- 9) %>%
  filter(P.Value < 0.05)

coef_bm_sem <- coef(bm_sem_rich) %>%
  select(- 9) %>%
  filter(P.Value < 0.05)
```


```{r}
sem_caption <- paste0(
  "Metamodel of the Structural Equation Models for (A) biomass stability and
  (B) total biomass. ",
  "Results of the Structural Equation Models for (C) the
  determinants of biomass stability and (D) total biomass. Red and green
  represent respectively negative and positive path coefficients. The path
  coefficients are standardized coeffients. For convenience, only significant
  paths (i.e, *P < 0.05*) are shown."

)
```


```{r sem-plot, fig.height = 7, fig.cap = sem_caption}
#https://tex.stackexchange.com/questions/20496/drawing-different-tikz-shapes-parameterized-by-data-from-a-file?rq=1
#https://tex.stackexchange.com/questions/83888/how-to-plot-data-from-a-csv-file-using-tikz-and-csvsimple

plot_grid(
  meta_stab_sem_rich, meta_bm_sem_rich,
  p_stab_sem_rich, p_bm_sem_rich,
  labels = LETTERS[1:4], nrow = 2,
  rel_widths = c(1, 1)
)
```

```{r get-bm-sem-single-effect}
bm_sem_coef <- filter(coef_bm_sem, P.Value <= 0.05)

rich_on_bm <- get_clean_sem_coef(sem = bm_sem_coef, resp = "log_bm_std", pred = "log_rich_tot_std")
rich_on_tlvl <- get_clean_sem_coef(sem = bm_sem_coef, resp = "t_lvl", pred = "log_rich_tot_std")
tlvl_on_bm <- get_clean_sem_coef(sem = bm_sem_coef, resp = "log_bm_std", pred = "t_lvl")
RC1_on_bm <- get_clean_sem_coef(sem = bm_sem_coef, resp = "log_bm_std", pred = "log_RC1")
RC2_on_bm <- get_clean_sem_coef(sem = bm_sem_coef, resp = "log_bm_std", pred = "log_RC2")
```

```{r get-bm-tot-effect-env}
bm_all_params <- get_coefficient_piecewisesem(sem = bm_sem_rich, p_val_thl = NULL)

#Â effect of env on bm 
env_on_bm <- get_env_on_bm(fit = bm_all_params, p_val_thl = 0.05,
  type = "std")
# rich on bm 
rich_on_bm <- get_rich_on_bm(fit = bm_all_params,
  p_val_thl = 0.05, type = "std")

tmp_bm_indir_table <- map(list(env_on_bm, rich_on_bm),
  ~as_tibble(c(.x, list(variable = names(.x[[1]]))))
  ) %>%
bind_rows()
```

```{r}
stab_all_params <- get_coefficient_piecewisesem(sem = stab_sem_rich, p_val_thl = NULL)
#Â effect of env on stab
env_on_stab <- get_env_on_stab(fit = stab_all_params, p_val_thl = 0.05,
  type = "std")
rich_on_stab <- get_rich_on_stab(fit = stab_all_params,
  p_val_thl = 0.05, type = "std")
com_on_stab <- get_com_on_stab(fit = stab_all_params,
  p_val_thl = 0.05, type = "std")

tmp_stab_indir_table <- map(list(env_on_stab, rich_on_stab, com_on_stab),
  ~as_tibble(c(.x, list(variable = names(.x[[1]]))))
  ) %>%
bind_rows()
```
```{r get-sem-single-effect}
stab_sem_coef <- filter(coef_stab_sem, P.Value < 0.05)

sync_on_stab <- get_clean_sem_coef(sem = stab_sem_coef, resp = "log_stab_std", pred = "log_sync")
cv_sp_on_stab <- get_clean_sem_coef(sem = stab_sem_coef, resp = "log_stab_std", pred = "log_cv_sp")
RC1_on_sync <- get_clean_sem_coef(sem = stab_sem_coef, resp = "log_sync", pred = "log_RC1")
tlvl_on_cv_sp <- get_clean_sem_coef(sem = stab_sem_coef, resp = "log_cv_sp", pred = "t_lvl")
```

```{r get-sem-tot-effect-env}
# effect of env on sync and cv_sp
env_on_sync <- get_env_on_stab_comp(fit = stab_all_params,
  p_val_thl = 0.05,
  stab_comp = "log_sync", type = "std")
env_on_cv_sp <- get_env_on_stab_comp(fit = stab_all_params,
  p_val_thl = 0.05,
  stab_comp = "log_cv_sp", type = "std")
# env on stab via network 
env_on_t_lvl <- get_env_on_com(fit = stab_all_params,
  p_val_thl = 0.05,
  com = "t_lvl", type = "std")
env_on_ct <- get_env_on_com(fit = stab_all_params,
  p_val_thl = 0.05,
  com = "ct", type = "std")
env_on_richness <- get_env_on_rich(fit = stab_all_params,
  p_val_thl = 0.05, type = "std")
```


# Results

Overall, the structural equation models explained a large part of the variation
of connectance, synchrony, $\overline{CV_{sp}}$ and total biomass (resp. $R^2 =
.45$, $.47$, $.49$ and $.38$) but less so for mean trophic level ($R^2 =
.18$, Figure \@ref(fig:sem-plot) C and D). We found that species richness had a
significant negative effect on mean trophic level ($r_\delta = 
`r rich_on_tlvl`$) and connectance ($r_\delta = `r rich_on_stab$total`$, Figure
\@ref(fig:sem-plot) C and D), meaning that the effects of species richness and
network structure are not independant.

## Species richness and average trophic level are positively correlated to total biomass

```{r get-sem-tot-effect-rich}
rich_on_sync <- get_rich_on_stab_comp(fit = stab_all_params,
  p_val_thl = 0.05,
  stab_comp = "log_sync", type = "std")
rich_on_cv_sp <- get_rich_on_stab_comp(fit = stab_all_params,
  p_val_thl = 0.05,
  stab_comp = "log_cv_sp", type = "std")
```

Species richness and mean trophic level had a significant positive direct effect
on total biomass ($r_\delta = `r rich_on_bm$direct`$ and $r_\delta = 
`r tlvl_on_bm`$ resp., Figure \@ref(fig:sem-plot) D, Table \@ref(tab:indir-sem)),
while connectance had no direct significant effect on total biomass (Figure
\@ref(fig:sem-plot) D). The total effect of mean trophic level
on total biomass was of the same magnitude than the one of species richness
(resp. $`r tlvl_on_bm`$ and $`r rich_on_bm$total`$, Table \@ref(tab:indir-sem)). 

The two PCA axis capturing environmental variables had no significant direct effects on total biomass
(Table SXX), but indirect (Table \@ref(tab:indir-sem)). The first axis, PCA1,
related to the stream size was positively linked to total biomass ($r_\delta = 
`r env_on_bm$total["log_RC1"]`$, Table \@ref(tab:indir-sem)),
through species richness and mean trophic level too ($r_\delta = 
`r env_on_bm$via_richness["log_RC1"]`$ and $`r env_on_bm$via_com["log_RC1"]`$
resp., Table \@ref(tab:indir-sem)). The second axis, PCA2, related the average
annual temperature and reversely to altitude of the sites was positively related
to total biomass ($r_\delta = `r env_on_bm$total["log_RC2"]`$, Table
\@ref(tab:indir-sem)), mainly through species richness ($r_\delta = 
`r env_on_bm$via_richness["log_RC2"]`$, Table \@ref(tab:indir-sem)). The effect
of PCA2 on total biomass was of the same magnitude than the effects on species
richness and mean trophic level.


## Temporal stability of annual biomass

By its effects on synchrony and $\overline{CV_{sp}}$, species richness had a
negative total effect on biomass stability ($r_\delta = `r rich_on_stab$total`$,
Table \@ref(tab:indir-sem)). On the one hand, species richness had a direct
negative effect on synchrony ($r_\delta = `r rich_on_sync$direct`$), thereby
increasing stability ($r_\delta = `r rich_on_stab$via_sync`$). On the other
hand, species richness had a positive direct effect on $\overline{CV_{sp}}$
($r_\delta = `r rich_on_cv_sp$direct`$),
thereby decreasing biomass stability ($r_\delta = `r rich_on_stab$via_cv_sp`$, Table
\@ref(tab:indir-sem)). The negative effect of $\overline{CV_{sp}}$ on temporal
stability was twice higher than the negative effect of synchrony (resp.
$r_\delta = `r cv_sp_on_stab`$ and $r_\delta = `r sync_on_stab`$, Figure
\@ref(fig:sem-plot) C).

The total effect of mean trophic level on temporal stability of biomass was of
the same magnitude than the one of species richness (resp.
$`r com_on_stab$total["t_lvl"]`$ and $`r rich_on_stab$total`$, Table
\@ref(tab:indir-sem)).
The mean trophic level had only a direct negative effect on
$\overline{CV_{sp}}$ ($r_\delta = `r tlvl_on_cv_sp`$,
Figure \@ref(fig:sem-plot) C) and thereby had a total positive
effect on temporal stability ($r_\delta = `r com_on_stab$via_cv_sp["t_lvl"]`$,
Table \@ref(tab:indir-sem)). Connectance had no significant direct on either
$\overline{CV_{sp}}$ nor synchrony and thus no effect on temporal stability
(Figure \@ref(fig:sem-plot) C, Table SXX).
 
The total effect of PCA2, related to average annual temperature and reversely to
altitude, on temporal stability was of higher magnitude than the effects of
species richness and mean trophic level (Table
\@ref(tab:indir-sem)).
The PCA2 had a total negative effect on temporal stability, meaning that higher
temperature results in lower stability
($r_\delta = `r env_on_stab$total["log_RC2"]`$, Table \@ref(tab:indir-sem)). 
PCA2 had an indirect positive effect on temporal stability through a
direct positive effect on $\overline{CV_{sp}}$ ($r_\delta = 
`r env_on_cv_sp$direct["log_RC2"]`$, Table \@ref(tab:indir-sem)) but also a
negative on through species richness but a positive one through
mean trophic level
(resp. $r_\delta = `r env_on_stab$via_richness["log_RC2"]`$ and
$r_\delta = `r env_on_stab$via_com["log_RC2"]`$, Table \@ref(tab:indir-sem)).
This was also true for the PCA1, related to stream size, but effects were weaker
than for PCA2.


```{r indir-stab, results = TRUE}
caption_sem <- paste0(
  "Direct, indirect and total effect of environment, species richness and
  network structure, i.e. connectance and mean trophic level on total biomass
  and its temporal stability. Indirect effects are computed by multiplying the
  path coefficients from the variable predictor to the response variable, here
  biomass stability. Indirect effects are considered as one step from the target
  variable. For exemple, the indirect effect of species richness on
  biomass stability via its effect on CVsp is $-0.61$. To compute indirect
  effect, only the significant direct effects were taken into account. ",
  "Network structure being the indirect effect that went through both avg trophic
  level and connectance and Species richness_Network structure being the
  indirect effect that went through (i) species richness and from (ii) species
  richness to network structure."
)

full_table <- bind_rows(
  tmp_bm_indir_table,
  tmp_stab_indir_table
) %>%
select(variable, direct, via_richness, via_richness_com, via_com, via_cv_sp, via_sync, total) %>%
format_table()

kable(full_table,
  format = "latex",
  booktabs = T,
  label = paste0("indir-sem"),
  caption = caption_sem
  ) %>%
kable_styling(latex_options =c("striped", "scale_down")) %>%
pack_rows("Total biomass", 1, 3) %>%
pack_rows("Temporal stability of biomass", 4, 8)
```

# Discussion

Overall, our study is unique by its level of integration, from environmental
effects to total biomass and stability, going through species richness and
network structure, and the first direct assessment of a possible joint effect of
species richness and network structure.  We found that species richness and mean
trophic level had a positive effect on total biomass. In contrast, species
richness had a negative effect on temporal stability whereas mean trophic level
covaried positively. We also found that the effect of species richness and mean
trophic level on total biomass and its temporal stability were not independant
as species richness had a negative effect on mean trophic level.  Furthermore,
we found that connectance had no significant effect on both total biomass and
its temporal stability. Finally, we found that the magnitude of the effects of
average temperature and altitude was equal or superior to the effects of species
richness and mean trophic level. 

## Species richness increased total biomass but decreased its temporal stability 

We found that species richness increased total biomass as found in salt marshes,
grasslands and forests [@hector_plant_1999; @tilman_biodiversity_2014;
@wu_relationship_2015; @li_relationship_2018]. The positive effect of species
richness on total biomass might be due to resource use complementarity
[@carey_determining_2011], which is held by niche differentiation
[@loreau_biodiversity_1998; @loreau_partitioning_2001] or to the higher
probability to get high biomass species  with higher species richness
[@loreau_biodiversity_2001].

Surprisingly we found a negative relationship between temporal stability and
species richness. Overall, it contrasts with experimental studies in grasslands
[@tilman_biodiversity_2006]; mesocosms (Pennekamp et al. 2018), in 
butterflies natural communities [@olivier_urbanization_2020] or even in lotic
fish communities [@franssen_annual_2011] where positive relationships were found
between temporal stability and species richness. However other studies found a
opposite relationship in natural grassland [@yang_effects_2011] or a marginal
one in natural forests [@declerck_species_2006]. 

A first step to identify the mechanisms behind those contrasting patterns is to
look at the effects of species richness on synchrony and $\overline{CV_{sp}}$.
As most studies on the topic, in experimental grasslands
[@isbell_biodiversity_2009; @roscher_identifying_2011], in natural communities
of birds, bats, grasslands, bats and butterflies [@bluthgen_land_2016;
@olivier_urbanization_2020], we found that species richness decreases synchrony,
thereby increasing stability [but see @declerck_species_2006]. Our study thus
highlights that species richness might also decrease synchrony in empirical
trophic communities. Species richness can reduce synchrony when a given
increase in species richness leads to a decrease of population sizes but also in
the case where species have different responses to environmental variation
[@loreau_species_2008]. 

The positive effect of species richness on
$\overline{CV_{sp}}$, thereby decreasing stability, is more intriguing. While
positive effect of species richness on $\overline{CV_{sp}}$ was reported in
experimental grasslands and natural bird communities [@tilman_biodiversity_2006;
@olivier_urbanization_2020], negative and neutral relationships have been found
in butterfly and bat communities. ** Our results contrast with a previous
meta-analysis which concludes that species richness had a positive effect on
population stability in multi-trophic aquatic microcosms
[@jiang_different_2009]. In foodwebs, the relationship between temporal
stability of populations and species richness depends on interaction strength
and their distribution [@mccann_reevaluating_1997; @thebault_trophic_2005;
@brose_allometric_2006], high interaction strength inducing a negative
relationship. Overall, more research is needed to assess the links between
species richness and the functioning of empirical foodwebs.**
  


---
#@thibaut_understanding_2013 proposed that a
#strongly uneven biomass distribution across populations and that the biomass
#variance of population increases much faster than its mean can generate a
#positive effect of species richness on population ($\overline{CV_{sp}}$)
#stability.
---


## Average trophic level increased total biomass and its temporal stability

The average trophic level was positively linked to total biomass.
Experimental and theoretical work suggested that a higher trophic level is the
result of a stronger top-down effect, meaning higher predation rates and biomass
fluxes to higher trophic levels [@kratina_warming_2012], hence leading to an
increase in total biomass with trophic length. Furthermore,
@wang_biodiversity_2016 have shown that total nutrient uptake might increases
with the length of trophic chain and so results in higher total biomass. 

In contrast, connectance had no effect on total biomass. One might have expected
that an increase in connectance may translate in higher total nutrient uptake
and so results in higher total biomass in the fish compartment. A reason for
such an absence of an effect might be due our data lacks informations about the
lower compartments of the community, i.e, the primary producers, zooplankton and
zoobenthos.

Mean trophic level had a positive effect on biomass stability by its negative
effect on $\overline{CV_{sp}}$, thereby increasing average species stability. It
might be because species at higher trophic level are more stable than the species at
lower trophic levels as predicted by food chains models [@barbier_pyramids_2019;
@shanafelt_stability_2018] but it is not sure that it holds when considering
omnivorous species [@wang_biodiversity_2016]. An alternative explanation is that
higher mean trophic level leads to stronger top-down control and resource
complementarity and thus reduce biomass fluctuations in lower trophic levels
[@rooney_structural_2006].

We found that connectance had no effect on temporal stability. This result
contradicts previous precedent theoretical studies on the relationship between
stability and network structure [@angelis_stability_1975; @may_will_1972;
@thebault_stability_2010; but see @neutel_reconciling_2007], although they
considered different stability concepts and metrics [@arnoldi_resilience_2016].
However, our measure of connectance suffers limitation (discussed above) and
further research should examine the effect of connectance on temporal stability
in more complete empirical foodwebs.

## Population stability was the main driver of temporal stability

**It was unexpected that the average population variability ($\overline{CV_{sp}}$) had a
stronger negative effect on biomass stability than synchrony
[@bluthgen_land_2016; @olivier_urbanization_2020], and explain why we observe a
negative effect of species richness on temporal stability of biomass. The lower
effect of synchrony might be explained by the presence of generalist predators in
stream communities, which can raise synchrony between prey species which shares
the same predator [@raimondo_interspecific_2004]. In the other way, it is
possible that, in aquatic foodwebs, the occurrence of large oscillatory dynamics
[@mccann_reevaluating_1997] leads to a higher contribution of population
variability rather than synchrony to community stability. How both
strengths and the relative contribution of synchrony and population
variaribility to overall stability vary between foodwebs and single trophic communities is
still an open question.**

---
#Rough average synchrony in ThÃ©ophile study: exp(-0.75) = .47 or exp(-0.6) = .54
#This study: sync avg = .69
---


## Environment had an high effect on total biomass and its temporal stability 

**We found that the total effect of environmental drivers on total biomass and its
stability was indirect and of the same magnitude order than the effect of
species richness and average trophic level, highlighting that environmental
changes may result in signicant ecosystem responses, through alteration of
both species richness and network structure.**

Consistent with research showing that food webs in wider streams, are also
larger, and hence support more species and biomass [@allan_stream_2007], we
found that the PCA axis related to stream size had a positive effect on total
biomass through a positive effect on mean trophic level. Greater ecosystem size
might provide a greater diversity of resources through habitat heterogeneity,
and so higher species richness and total biomass by surface unit, through
resource complementarity. Greater diversity of resources can also maintain
more biomass at high trophic level [@post_ecosystem_2000; @doi_resource_2009].
Furthermore, the positive effect of the PCA axis related to temperature on total
biomass was of the magnitude of effects of network structure and species
richness, in line with the mounting body of work reporting important effects of
temperature on the structure and biomass of aquatic system [e.g.
@dossena_warming_2012; @edeline_ecological_2013; @emmrich_geographical_2014;
@hattab_forecasting_2016]. Contrasting with a previous study in experimental
plant communities [@grace_integrative_2016] and in fish communities
[@yvondurocher_warming_2011; @dossena_warming_2012], we found that environmental
drivers overall affect total biomass indirectly rather than directly.

Interestingly, the two PCA axis related to environmental conditions had indirect
effects on stability through two conflicting pathways, either stabilising, via
network structure, or destabilising, via species richness. The first pathway
consists in a positive effect of temperature and stream properties on mean
trophic level, in line with the idea that wider streams and warmer conditions
are favourable to mesotrophic predators [@allan_stream_2007;
@emmrich_geographical_2014], which in turn stabilises biomass fluctuations,
possibly due to increased top-down regulation. The second pathway consists in a
positive effect of temperature and stream size on species richness, which itself
has a destabilising effect. This result is interesting in that though both
pathways had not been evidenced to be jointly to play, as far as we know.
Furthermore, it is unclear under which circumstance which pathway is dominating,
opening an interesting avenue for further investigations.


---
## Final thoughts about empirical foodwebs

#It was unexpected that the average population $\overline{CV_{sp}}$
#had a stronger negative effect on biomass stability than synchrony
#[@bluthgen_land_2016; @olivier_urbanization_2020], and explain why we observe a
#negative effect of species on temporal stability of biomass. The lower effect of
#synchrony can be explained by the  presence of generalist predators in stream
#communities, which can raise synchrony between prey species which shares the
#same predator [@raimondo_interspecific_2004]. Uneven population biomass within
#communities also raise synchrony between species [@thibaut_understanding_2013].

#As found in other studies, we found that species richness was negatively related
#to mean trophic level and connectance [@winemiller_must_1989;
#@dunne_network_2006; @thebault_stability_2010]. Species richness had thus a
#consistent destabilising effect on temporal stability of biomass directly and
#through average trophic level, but it has a direct positive effect on total annual
#biomass directly but a negative one through the decrease of average trophic
#level. It highlights the importance to consider several aspects of
#network structure to order to improve our understanding of the drivers of
#community structure and stability.
---

# Conclusion and perspectives 

While theoretical ecology has focused on the effects of network structure on
stability, empirical ecology has focused on species richness and ignored network
structure. Furthermore, both fields have largely used different stability
metrics. Our work thus aims to contribute at bridging this gap between
theoretical and empirical ecology.

Our study extends the assessment of the effect of species richness on total
annual biomass and its temporal stability in natural settings to the case of
foodwebs, while including network structure. Species richness had a direct
positive and negative effect respectively on total biomass and its stability but
mean trophic level had a positive effect on both. We furthermore found that
species richness had antagonistic effects on total biomass, through its effect
on mean trophic level. Our study thus highlights the importance to consider both
species richness, network structure and their dependence. However, the
mechanisms leading to such remains to be elucidated. Finally, we found that
environmental gradient related to temperature and ecosystem size have
antagonistic effects on biomass temporal stability, positive through mean
trophic level and negative through species richness. Further research is needed
to find the mechanisms behind those pathways, that are crucial in context of
global changes. 

One limitation of our study is that the use of inferred networks, i.e. not
observed interactions, and the lack of information about the foodwebs outside
fishes. We look forward to see our findings and their interpretation tested by
experimental and theoretical works considering foodwebs, allowing explore the
effects of omnivory and ontogeny on the link between network structure and
ecosystem functioning.

 

```{r}
save.image(file = mypath("manuscript", "bef_stability", "result", "workspace.rda"))
```

# References
